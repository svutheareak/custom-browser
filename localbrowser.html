<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Browser (HTTP)</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        .hide {
            display: none !important;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: white;
            height: 100vh;
            overflow: hidden;
        }

        .browser-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            display: flex;
            gap: 12px;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .nav-buttons {
            display: flex;
            gap: 8px;
        }

        .nav-button {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px 14px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-button:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .nav-button:disabled {
            background: rgba(255,255,255,0.1);
            cursor: not-allowed;
            transform: none;
        }

        .url-bar {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 25px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 14px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .url-bar:focus {
            outline: none;
            border-color: rgba(255,255,255,0.5);
            background: rgba(255,255,255,0.2);
        }

        .url-bar::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .go-button, .test-button {
            background: linear-gradient(45deg, #00c6ff, #0072ff);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-left: 5px;
        }

        .go-button:hover, .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,114,255,0.4);
        }

        .iframe-container {
            height: calc(100vh - 80px);
            background: white;
            position: relative;
        }

        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .config-form {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(42, 42, 42, 0.98);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            padding: 30px;
            width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            display: none;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.7);
            z-index: 2000;
        }

        .config-form.show {
            display: block;
            animation: popIn 0.3s ease;
        }

        @keyframes popIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .config-form h2 {
            color: #00c6ff;
            margin-bottom: 20px;
            text-align: center;
            font-size: 24px;
        }

        .form-section {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .form-section h3 {
            color: #00c6ff;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: end;
        }

        .form-row.single {
            display: block;
        }

        .form-group {
            flex: 1;
        }

        .form-group label {
            display: block;
            color: rgba(255,255,255,0.8);
            margin-bottom: 5px;
            font-size: 14px;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #00c6ff;
            background: rgba(255,255,255,0.15);
        }

        .form-group input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .form-button {
            background: linear-gradient(45deg, #00c6ff, #0072ff);
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .form-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,114,255,0.4);
        }

        .form-button.secondary {
            background: rgba(255,255,255,0.2);
        }

        .form-button.secondary:hover {
            background: rgba(255,255,255,0.3);
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: rgba(255,0,0,0.7);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 1500;
        }

        .overlay.show {
            display: block;
        }

        .custom-domains.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .custom-domains h3 {
            margin-bottom: 15px;
            color: #00c6ff;
            text-align: center;
        }

        .domain-item {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .domain-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .domain-name {
            font-weight: bold;
            color: #00c6ff;
            font-size: 14px;
        }

        .delete-domain {
            background: rgba(255, 0, 0, 0.7);
            border: none;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 10px;
        }

        .path-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            font-size: 11px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .path-item:last-child {
            border-bottom: none;
        }

        .delete-path {
            background: rgba(255, 100, 100, 0.7);
            border: none;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 9px;
        }

        .add-domain-section {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }

        .add-domain-section h4 {
            color: #00c6ff;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .input-group {
            margin-bottom: 8px;
        }

        .input-group label {
            display: block;
            font-size: 10px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 3px;
        }

        .add-domain {
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .add-domain input {
            padding: 8px 12px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 12px;
        }

        .add-domain input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .add-domain button {
            padding: 10px;
            background: linear-gradient(45deg, #00c6ff, #0072ff);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .add-domain button:hover {
            transform: translateY(-1px);
        }

        .status-message {
            position: fixed;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            display: none;
            z-index: 1000;
        }

        .status-message.error {
            background: rgba(255, 0, 0, 0.9);
        }

        .status-message.success {
            background: rgba(0, 255, 0, 0.9);
            color: black;
        }

        .welcome-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
        }

        .welcome-screen h1 {
            font-size: 3em;
            margin-bottom: 20px;
            animation: fadeInUp 1s ease;
        }

        .welcome-screen p {
            font-size: 1.2em;
            opacity: 0.8;
            animation: fadeInUp 1s ease 0.2s both;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="browser-header">
        <div class="nav-buttons">
            <button class="nav-button" id="backBtn" disabled>‚Üê</button>
            <button class="nav-button" id="forwardBtn" disabled>‚Üí</button>
            <button class="nav-button" id="refreshBtn">‚ü≥</button>
        </div>
        <input type="text" class="url-bar" id="urlBar" placeholder="Enter URL or hello123123.com" value="hello123123.com">
        <button class="go-button" id="goBtn">Go</button>
        <button class="test-button" id="testBtn">Test Server</button>
        <button class="nav-button" id="configBtn">‚öôÔ∏è Config</button>
        <button class="nav-button" id="domainsBtn">üëÅÔ∏è Domains</button>
    </div>
    
    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>
    
    <!-- Configuration Form -->
    <div class="config-form" id="configForm">
        <button class="close-btn" onclick="closeConfigForm()">√ó</button>
        <h2>üîß Domain Configuration</h2>
        
        <div class="form-section">
            <h3>Add New Domain</h3>
            <div class="form-row">
                <div class="form-group">
                    <label>Domain Name:</label>
                    <input type="text" id="formDomain" placeholder="hello123123.com">
                </div>
                <button class="form-button" onclick="addDomainFromForm()">Create</button>
            </div>
        </div>
        
        <div class="form-section">
            <h3>Add Path Mapping</h3>
            <div class="form-row">
                <div class="form-group">
                    <label>Select Domain:</label>
                    <select id="formSelectDomain">
                        <option value="">Choose domain...</option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Path:</label>
                    <input type="text" id="formPath" placeholder="/app1">
                </div>
                <div class="form-group">
                    <label>Target Server:</label>
                    <input type="text" id="formTarget" placeholder="http://13.222.189.89:9001">
                </div>
                <button class="form-button" onclick="addPathFromForm()">Add Path</button>
            </div>
        </div>
        
        <div class="form-section">
            <h3>üì• Import JSON Configuration</h3>
            <div class="form-row single">
                <div class="form-group">
                    <label>Paste your JSON configuration:</label>
                    <textarea id="jsonImport" placeholder='Paste your JSON here, e.g.:
{
  "configVersion": "1.0",
  "domains": {
    "theareak.com": {
      "paths": {
        "/": "http://127.0.0.1:3000",
        "/app1": "http://13.222.189.89:9001"
      }
    }
  }
}' style="
                        width: 100%;
                        height: 120px;
                        padding: 12px;
                        border: 2px solid rgba(255,255,255,0.2);
                        border-radius: 8px;
                        background: rgba(255,255,255,0.1);
                        color: white;
                        font-size: 12px;
                        font-family: monospace;
                        resize: vertical;
                    "></textarea>
                </div>
            </div>
            <div class="form-row">
                <button class="form-button" onclick="importFromJSON()">üì• Import JSON</button>
                <button class="form-button secondary" onclick="clearJSONInput()">üóëÔ∏è Clear</button>
            </div>
        </div>
        
        <div class="form-section">
            <h3>‚ö†Ô∏è Important: Configuration Storage</h3>
            <div style="background: rgba(255,193,7,0.1); border: 1px solid #ffc107; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                <p style="color: #ffc107; font-size: 13px; line-height: 1.5; margin: 0;">
                    <strong>üìç Where configs are saved:</strong><br>
                    ‚Ä¢ Form/JSON changes ‚Üí Browser memory only (temporary)<br>
                    ‚Ä¢ Permanent storage ‚Üí Manual copy to HTML file<br>
                    ‚Ä¢ Use "üìã Show JSON" to get your configuration
                </p>
            </div>
        </div>
        
        <div class="form-section">
            <h3>Configuration Management</h3>
            <div class="form-row">
                <button class="form-button secondary" onclick="reloadConfig()">üîÑ Reload</button>
                <button class="form-button" onclick="exportCurrentConfig()">üìã Show JSON</button>
                <button class="form-button secondary" onclick="clearAllConfig()">üóëÔ∏è Clear All</button>
            </div>
        </div>
        
        <div class="form-section">
            <h3>Quick Setup</h3>
            <button class="form-button secondary" onclick="addExampleConfig()">üìù Add Example Config</button>
            <p style="font-size: 11px; color: rgba(255,255,255,0.5); margin-top: 5px;">
                Adds hello123123.com and hello1133.com with your specified IPs
            </p>
        </div>
        
        <div style="text-align: center; margin-top: 20px;">
            <button class="form-button" onclick="closeConfigForm()">‚úÖ Done</button>
        </div>
    </div>
    
    <!-- Domain List Panel -->
    <div class="custom-domains hide" id="customDomains">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h3 style="margin: 0;">Current Domains</h3>
            <button class="nav-button" onclick="window.toggleDomains()" style="padding: 5px 10px; font-size: 12px;">üôà Hide</button>
        </div>
        <div id="domainList"></div>
    </div>
    
    <div class="iframe-container" id="iframeContainer">
        <div class="welcome-screen">
            <h1>üåê Custom Browser</h1>
            <p id="modeStatus">Configuration embedded in browser</p>
            <p style="font-size: 0.9em; margin-top: 10px;">
                Domains loaded: <span id="domainCount">0</span>
            </p>
            <p style="font-size: 0.8em; margin-top: 15px; color: rgba(255,255,255,0.6);" id="configStatus">
                Loading embedded configuration...
            </p>
        </div>
    </div>

    <div class="status-message" id="statusMessage"></div>

    <script>
        // Custom domain mappings with paths - starts empty, user fills via form
        let customDomains = JSON.parse(localStorage.getItem('customDomains')) || {};

        const urlBar = document.getElementById('urlBar');
        const goBtn = document.getElementById('goBtn');
        const testBtn = document.getElementById('testBtn');
        const backBtn = document.getElementById('backBtn');
        const forwardBtn = document.getElementById('forwardBtn');
        const refreshBtn = document.getElementById('refreshBtn');
        const configBtn = document.getElementById('configBtn');
        const configForm = document.getElementById('configForm');
        const overlay = document.getElementById('overlay');
        const customDomainsPanel = document.getElementById('customDomains');
        const iframeContainer = document.getElementById('iframeContainer');
        const statusMessage = document.getElementById('statusMessage');

        let currentIframe = null;
        let history = [];
        let historyIndex = -1;

        // Show status message
        function showStatus(message, type = 'info') {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type}`;
            statusMessage.style.display = 'block';
            setTimeout(() => {
                statusMessage.style.display = 'none';
            }, 3000);
        }

        // Test server connectivity - now tests user-configured domains
        async function testServer() {
            if (Object.keys(customDomains).length === 0) {
                showStatus('No domains configured yet. Add some domains first!', 'error');
                return;
            }
            
            // Test the first available target URL
            const firstDomain = Object.keys(customDomains)[0];
            const firstPath = Object.keys(customDomains[firstDomain])[0];
            const testUrl = customDomains[firstDomain][firstPath];
            
            showStatus(`Testing: ${testUrl}`, 'info');
            
            try {
                // Try to fetch the server
                const response = await fetch(testUrl, { 
                    mode: 'no-cors',
                    method: 'HEAD'
                });
                showStatus(`Server appears to be reachable: ${testUrl}`, 'success');
            } catch (error) {
                showStatus(`Server test failed for ${testUrl}: ${error.message}`, 'error');
                console.log('Full error:', error);
            }
        }

        let domainsVisible = false;

        function toggleDomains() {
            const panel = document.getElementById('customDomains');
            const btn = document.getElementById('domainsBtn');

            if (domainsVisible) {
                panel.classList.add('hide');
                btn.textContent = 'üëÅÔ∏è Domains'; // optional: revert button label
            } else {
                panel.classList.remove('hide');
                btn.textContent = 'üôà Hide'; // optional: change to indicate next action
            }

            domainsVisible = !domainsVisible;
        }


        // Navigation functionality
        function navigate(url) {
            try {
                let targetUrl = url;
                
                // Add protocol if missing
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    url = 'http://' + url;
                }

                // Parse URL to check for custom domain
                const urlObj = new URL(url);
                const hostname = urlObj.hostname;
                
                // Check if it's a custom domain
                if (customDomains[hostname]) {
                    const domainPaths = customDomains[hostname];
                    const requestPath = urlObj.pathname || '/';
                    
                    // Find exact path match or use default
                    if (domainPaths[requestPath]) {
                        targetUrl = domainPaths[requestPath] + urlObj.search;
                    } else if (domainPaths['/']) {
                        targetUrl = domainPaths['/'] + requestPath + urlObj.search;
                    } else {
                        // Use first available path as fallback
                        const firstPath = Object.keys(domainPaths)[0];
                        targetUrl = domainPaths[firstPath] + requestPath + urlObj.search;
                    }
                    
                    showStatus(`Redirecting ${hostname}${requestPath} ‚Üí ${targetUrl}`, 'info');
                } else {
                    targetUrl = url;
                }

                // Create new iframe
                if (currentIframe) {
                    currentIframe.remove();
                }

                currentIframe = document.createElement('iframe');
                currentIframe.src = targetUrl;
                currentIframe.style.width = '100%';
                currentIframe.style.height = '100%';
                currentIframe.style.border = 'none';
                
                // Handle iframe events
                currentIframe.onload = () => {
                    showStatus(`Loaded: ${targetUrl}`, 'success');
                };
                
                currentIframe.onerror = () => {
                    showStatus('Failed to load: ' + targetUrl, 'error');
                };

                iframeContainer.innerHTML = '';
                iframeContainer.appendChild(currentIframe);

                // Update address bar
                urlBar.value = url;

                // Update history
                if (historyIndex < history.length - 1) {
                    history = history.slice(0, historyIndex + 1);
                }
                history.push(url);
                historyIndex = history.length - 1;
                updateNavigationButtons();

            } catch (error) {
                showStatus('Invalid URL: ' + url, 'error');
            }
        }

        // Update navigation buttons
        function updateNavigationButtons() {
            backBtn.disabled = historyIndex <= 0;
            forwardBtn.disabled = historyIndex >= history.length - 1;
        }

        // Event listeners
        goBtn.addEventListener('click', () => {
            if (urlBar.value.trim()) {
                navigate(urlBar.value.trim());
            }
        });

        testBtn.addEventListener('click', testServer);

        urlBar.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && urlBar.value.trim()) {
                navigate(urlBar.value.trim());
            }
        });

        backBtn.addEventListener('click', () => {
            if (historyIndex > 0) {
                historyIndex--;
                navigate(history[historyIndex]);
            }
        });

        forwardBtn.addEventListener('click', () => {
            if (historyIndex < history.length - 1) {
                historyIndex++;
                navigate(history[historyIndex]);
            }
        });

        refreshBtn.addEventListener('click', () => {
            if (currentIframe) {
                currentIframe.src = currentIframe.src;
            }
        });

        configBtn.addEventListener('click', openConfigForm);

        domainsBtn.addEventListener('click', toggleDomains);

        overlay.addEventListener('click', closeConfigForm);

        // Form functions
        function openConfigForm() {
            configForm.classList.add('show');
            overlay.classList.add('show');
            updateFormDomainList();
        }

        function closeConfigForm() {
            configForm.classList.remove('show');
            overlay.classList.remove('show');
        }

        function updateFormDomainList() {
            const select = document.getElementById('formSelectDomain');
            select.innerHTML = '<option value="">Choose domain...</option>';
            
            Object.keys(customDomains).forEach(domain => {
                const option = document.createElement('option');
                option.value = domain;
                option.textContent = domain;
                select.appendChild(option);
            });
        }

        function addDomainFromForm() {
            const domain = document.getElementById('formDomain').value.trim();
            
            if (!domain) {
                showStatus('Please enter a domain name', 'error');
                return;
            }
            
            if (customDomains[domain]) {
                showStatus('Domain already exists! Use "Add Path" to modify it.', 'error');
                return;
            }
            
            // Create new domain configuration
            customDomains[domain] = {
                '/': 'http://127.0.0.1:3000' // default
            };
            
            // Save to localStorage and update single config file
            localStorage.setItem('customDomains', JSON.stringify(customDomains));
            updateSingleConfigFile();
            
            document.getElementById('formDomain').value = '';
            updateFormDomainList();
            loadCustomDomains();
            
            showStatus(`Domain created: ${domain} (config file updated)`, 'success');
        }

        function addPathFromForm() {
            const domain = document.getElementById('formSelectDomain').value;
            const path = document.getElementById('formPath').value.trim();
            const target = document.getElementById('formTarget').value.trim();
            
            if (!domain || !path || !target) {
                showStatus('Please fill all fields', 'error');
                return;
            }
            
            const normalizedPath = path.startsWith('/') ? path : '/' + path;
            
            if (!customDomains[domain]) {
                customDomains[domain] = {};
            }
            
            // Check if this path already exists (modify vs create)
            const isModifying = customDomains[domain][normalizedPath] !== undefined;
            
            customDomains[domain][normalizedPath] = target;
            localStorage.setItem('customDomains', JSON.stringify(customDomains));
            
            // Update single config file
            updateSingleConfigFile();
            
            document.getElementById('formPath').value = '';
            document.getElementById('formTarget').value = '';
            loadCustomDomains();
            
            const action = isModifying ? 'Modified' : 'Added';
            showStatus(`${action}: ${domain}${normalizedPath} ‚Üí ${target} (config updated)`, 'success');
        }
        // Load configuration from embedded data or localStorage
        function loadConfigFromEmbedded() {
            try {
                // First try to load from localStorage (if user made changes)
                const saved = localStorage.getItem('customDomains');
                if (saved) {
                    const savedDomains = JSON.parse(saved);
                    if (Object.keys(savedDomains).length > 0) {
                        customDomains = savedDomains;
                        showStatus('‚úÖ Config loaded from saved changes', 'success');
                        return true;
                    }
                }
                
                // Use embedded configuration
                localStorage.setItem('customDomains', JSON.stringify(customDomains));
                showStatus('‚úÖ Config loaded from embedded data', 'success');
                return true;
            } catch (error) {
                showStatus(`Error loading config: ${error.message}`, 'error');
                return false;
            }
        }

        // Update embedded configuration (for copying to file)
        function updateEmbeddedConfig() {
            const config = {
                configVersion: "1.0",
                lastUpdated: new Date().toISOString(),
                totalDomains: Object.keys(customDomains).length,
                domains: {}
            };
            
            // Add all domains with metadata
            for (const [domain, paths] of Object.entries(customDomains)) {
                config.domains[domain] = {
                    domain: domain,
                    totalPaths: Object.keys(paths).length,
                    paths: paths
                };
            }
            
            console.log('Current config for your JSON file:', JSON.stringify(config, null, 2));
            return config;
        }

        // Save configuration to memory only (no downloads)
        function updateSingleConfigFile() {
            // Just save to localStorage
            localStorage.setItem('customDomains', JSON.stringify(customDomains));
            
            // Update embedded config and show in console
            const config = updateEmbeddedConfig();
            
            showStatus('Configuration updated (check console for JSON)', 'success');
            console.log('=== Copy this to your config file ===');
            console.log(JSON.stringify(config, null, 2));
        }

        // Export current configuration (for manual saving)
        function exportCurrentConfig() {
            const config = updateEmbeddedConfig();
            
            // Show the JSON in a popup for manual copying
            const configJson = JSON.stringify(config, null, 2);
            
            // Create a modal to show the config
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 3000;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: #2a2a2a;
                    border-radius: 15px;
                    padding: 20px;
                    max-width: 80%;
                    max-height: 80%;
                    overflow: auto;
                    border: 2px solid #00c6ff;
                ">
                    <h3 style="color: #00c6ff; margin-bottom: 15px;">üìã Copy Configuration</h3>
                    <p style="color: white; margin-bottom: 10px;">Copy this JSON to update your config file or embedded configuration:</p>
                    <textarea style="
                        width: 600px;
                        height: 400px;
                        background: #1a1a1a;
                        color: white;
                        border: 1px solid #555;
                        border-radius: 8px;
                        padding: 10px;
                        font-family: monospace;
                        font-size: 12px;
                    " readonly>${configJson}</textarea>
                    <div style="margin-top: 15px; text-align: center;">
                        <button style="
                            background: #00c6ff;
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 8px;
                            cursor: pointer;
                            margin-right: 10px;
                        " onclick="
                            navigator.clipboard.writeText('${configJson.replace(/'/g, "\\'")}');
                            alert('Copied to clipboard!');
                        ">üìã Copy to Clipboard</button>
                        <button style="
                            background: #666;
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 8px;
                            cursor: pointer;
                        " onclick="document.body.removeChild(this.parentElement.parentElement.parentElement)">Close</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            showStatus('Configuration JSON ready to copy', 'info');
        }

        // Remove the download functionality
        // No longer needed since we're reading from local file

        // Import configuration from JSON textarea
        function importFromJSON() {
            const jsonInput = document.getElementById('jsonImport');
            const jsonText = jsonInput.value.trim();
            
            if (!jsonText) {
                showStatus('Please paste JSON configuration first', 'error');
                return;
            }
            
            try {
                const config = JSON.parse(jsonText);
                
                // Handle different JSON formats
                let newDomains = {};
                
                if (config.domains) {
                    // Full config format with domains object
                    for (const [domain, domainConfig] of Object.entries(config.domains)) {
                        if (domainConfig.paths) {
                            newDomains[domain] = domainConfig.paths;
                        }
                    }
                } else if (typeof config === 'object') {
                    // Direct domains format or simple object
                    newDomains = config;
                } else {
                    throw new Error('Invalid JSON format');
                }
                
                if (Object.keys(newDomains).length === 0) {
                    showStatus('No valid domains found in JSON', 'error');
                    return;
                }
                
                // Ask user if they want to replace or merge
                const action = confirm(
                    `Found ${Object.keys(newDomains).length} domain(s) in JSON.\n\n` +
                    'Click OK to REPLACE current config\n' +
                    'Click Cancel to MERGE with current config'
                );
                
                if (action) {
                    // Replace current configuration
                    customDomains = newDomains;
                    showStatus(`‚úÖ Replaced config with ${Object.keys(newDomains).length} domain(s)`, 'success');
                } else {
                    // Merge with current configuration
                    Object.assign(customDomains, newDomains);
                    showStatus(`‚úÖ Merged ${Object.keys(newDomains).length} domain(s) into current config`, 'success');
                }
                
                // Save and update UI
                localStorage.setItem('customDomains', JSON.stringify(customDomains));
                updateFormDomainList();
                loadCustomDomains();
                
                // Clear the input
                jsonInput.value = '';
                
                // Show what was imported
                console.log('=== IMPORTED CONFIGURATION ===');
                console.log('Imported domains:', Object.keys(newDomains));
                console.log('Full config:', customDomains);
                
            } catch (error) {
                showStatus(`Invalid JSON: ${error.message}`, 'error');
                console.error('JSON Import Error:', error);
            }
        }
        
        // Clear JSON input area
        function clearJSONInput() {
            document.getElementById('jsonImport').value = '';
            showStatus('JSON input cleared', 'info');
        }

        // Export configuration (shows JSON to copy manually)
        function exportAllConfigs() {
            exportCurrentConfig();
        }

        // Reset to embedded configuration
        function importConfig() {
            if (confirm('Reset to embedded configuration?')) {
                customDomains = {
                    "theareak.com": {
                        "/": "http://127.0.0.1:3000",
                        "/app1": "http://13.222.189.89:9001"
                    },
                    "theareak12.com": {
                        "/": "http://127.0.0.1:3000",
                        "/app2": "http://13.222.189.89:9002"
                    }
                };
                localStorage.setItem('customDomains', JSON.stringify(customDomains));
                updateFormDomainList();
                loadCustomDomains();
                showStatus('Reset to embedded configuration', 'success');
            }
        }

        // Reload configuration 
        function reloadConfig() {
            loadConfigFromEmbedded();
            updateFormDomainList();
            loadCustomDomains();
        }

        function addExampleConfig() {
            const examples = {
                'hello123123.com': {
                    '/app1': 'http://13.222.189.89:9001',
                    '/app2': 'http://13.222.189.89:9002',
                    '/': 'http://13.222.189.89:9001'
                },
                'hello1133.com': {
                    '/app1': 'http://13.222.189.90:9001',
                    '/app2': 'http://13.222.189.90:9002',
                    '/': 'http://13.222.189.90:9001'
                }
            };
            
            // Merge with existing configs
            Object.assign(customDomains, examples);
            localStorage.setItem('customDomains', JSON.stringify(customDomains));
            
            // Update single config file
            updateSingleConfigFile();
            
            updateFormDomainList();
            loadCustomDomains();
            
            showStatus('Example configurations added to config file!', 'success');
        }

        function clearAllConfig() {
            if (confirm('Clear all domain configurations?')) {
                customDomains = {};
                localStorage.setItem('customDomains', JSON.stringify(customDomains));
                updateFormDomainList();
                loadCustomDomains();
                
                // Create empty config file
                updateSingleConfigFile();
                
                showStatus('All configurations cleared', 'success');
            }
        }

        // Load and display custom domains
        function loadCustomDomains() {
            const domainList = document.getElementById('domainList');
            domainList.innerHTML = '';
            
            if (Object.keys(customDomains).length === 0) {
                domainList.innerHTML = '<p style="color: rgba(255,255,255,0.6); text-align: center;">No domains configured. Click Config button to add some!</p>';
                return;
            }
            
            for (const [domain, paths] of Object.entries(customDomains)) {
                const domainItem = document.createElement('div');
                domainItem.className = 'domain-item';
                
                let pathsHtml = '';
                for (const [path, target] of Object.entries(paths)) {
                    pathsHtml += `
                        <div class="path-item">
                            <span><strong>${path}</strong> ‚Üí ${target}</span>
                            <button class="delete-path" onclick="deletePath('${domain}', '${path}')">√ó</button>
                        </div>
                    `;
                }
                
                domainItem.innerHTML = `
                    <div class="domain-header">
                        <span class="domain-name">${domain}</span>
                        <button class="delete-domain" onclick="deleteDomain('${domain}')">Delete</button>
                    </div>
                    ${pathsHtml}
                `;
                
                domainList.appendChild(domainItem);
            }
        }

        // Delete domain
        function deleteDomain(domain) {
            if (confirm(`Delete domain "${domain}" and all its paths?`)) {
                delete customDomains[domain];
                localStorage.setItem('customDomains', JSON.stringify(customDomains));
                
                // Update single config file
                updateSingleConfigFile();
                
                loadCustomDomains();
                updateFormDomainList();
                showStatus(`Domain deleted: ${domain}`, 'success');
            }
        }

        // Delete specific path
        function deletePath(domain, path) {
            if (confirm(`Delete path "${domain}${path}"?`)) {
                delete customDomains[domain][path];
                
                // If no paths left, delete the domain
                if (Object.keys(customDomains[domain]).length === 0) {
                    delete customDomains[domain];
                }
                
                localStorage.setItem('customDomains', JSON.stringify(customDomains));
                
                // Update single config file
                updateSingleConfigFile();
                
                loadCustomDomains();
                updateFormDomainList();
                showStatus(`Path deleted: ${domain}${path}`, 'success');
            }
        }

        // Initialize
        async function initializeBrowser() {
            const configLoaded = loadConfigFromEmbedded();
            
            if (configLoaded) {
                updateFormDomainList();
                loadCustomDomains();
            }
            
            updateNavigationButtons();
            
            // Update status messages
            const domainCount = document.getElementById('domainCount');
            const configStatus = document.getElementById('configStatus');
            
            domainCount.textContent = Object.keys(customDomains).length;
            configStatus.textContent = `‚úÖ Configuration loaded (${Object.keys(customDomains).length} domains)`;
            configStatus.style.color = '#00c6ff';
        }

        // Make functions globally accessible
        window.importFromJSON = importFromJSON;
        window.clearJSONInput = clearJSONInput;
        window.addDomainFromForm = addDomainFromForm;
        window.addPathFromForm = addPathFromForm;
        window.exportCurrentConfig = exportCurrentConfig;
        window.addExampleConfig = addExampleConfig;
        window.clearAllConfig = clearAllConfig;
        window.deleteDomain = deleteDomain;
        window.deletePath = deletePath;
        window.openConfigForm = openConfigForm;
        window.closeConfigForm = closeConfigForm;
        window.reloadConfig = reloadConfig;
        window.toggleDomains = toggleDomains;

        // Call initialize
        initializeBrowser();

        // Close domains panel when clicking outside (only if visible)
        document.addEventListener('click', (e) => {
            if (domainsVisible && 
                !customDomainsPanel.contains(e.target) && 
                !domainsBtn.contains(e.target)) {
                toggleDomains();
            }
        });
    </script>
</body>
</html>